# P7_PythonNumpy基础

#### 这里是Python数据分析学习的第七篇笔记
本文包括了Numpy的数组对象和数据类型

---
## Numpy 数组对象

### Numpy数组
Numpy数组是一个多维数组对象，称为ndarray。该对象有两部分构成：

- 实际的数据 
- 描述这些数据的元数据  

大部分操作仅针对于元数据，而不改变底层实际的数据。

关于Numpy数组有几点是必须了解的：

- Numpy数组的下标是从0开始的
- 同一个Numpy数组中所有元素的类型必须相同

### Numpy数组属性
NumPy数组的维数称为秩（rank），一维数组的秩为1，二维数组的秩为2，以此类推。  
在NumPy中，每一个线性的数组称为是一个轴（axes），秩其实是描述轴的数量。比如说，二维数组相当于是两个一维数组，其中第一个一维数组中每个元素又是一个一维数组。  
所以一维数组就是NumPy中的轴（axes），第一个轴相当于是底层数组，第二个轴是底层数组里的数组。而轴的数量——秩，就是数组的维数。


NumPy的数组中比较重要ndarray对象属性有：

- ndarray.ndim：数组的维数（即数组轴的个数），等于秩。最常见的为二维数组（矩阵）。
- ndarray.shape：数组的维度。为一个表示数组在每个维度上大小的整数元组。例如二维数组中，表示数组的“行数”和“列数”。ndarray.shape返回一个元组，这个元组的长度就是维度的数目，即ndim属性。
- ndarray.size：数组元素的总个数，等于shape属性中元组元素的乘积。
- ndarray.dtype：表示数组中元素类型的对象，可使用标准的Python类型创建或指定dtype。另外也可使用NumPy提供的数据类型。
- ndarray.itemsize：数组中每个元素的字节大小。例如，一个元素类型为float64的数组itemsize属性值为8(float64占用64个bits，每个字节长度为8，所以64/8，占用8个字节），又如，一个元素类型为complex32的数组itemsize属性为4（32/8）。
- ndarray.data：包含实际数组元素的缓冲区，由于一般通过数组的索引获取元素，所以通常不需要使用这个属性。

### 创建数组


函数 | 说明
---|---
array | 将输入数据(列表、元组、数组或其它序列类型)转化为ndarray。要么推断出dtype，要么显式指定dtype。默认直接复制输入数据
asarray | 将输入转化为ndarray，如果输入本身就是一个ndarry就不进行复制
arange | 类似内置的range，但返回的是一个ndarray而不是列表
ones、ones\_like | 根据指定的形状和dtype创建一个全1数组。ones\_like以另一个数组为参数，并根据其形状和dtype创建一个全1数组
zeros、zeros_like | 根据指定的形状和dtype创建一个全0数组。
empty、empty_like | 创建新数组，只分配内存空间但不填充任何值。
eye、identity | 创建一个正方的N*N单位矩阵(对角线是1，其余是0)


#### array函数
创建数组的方法有很多。如可以使用array函数从常规的Python列表和元组创造数组。  
所创建的数组类型由原序列中的元素类型推导而来。
```
>>> from numpy import *  
　　　  
>>> a = array( [2,3,4] )　　　  
>>> a  
    array([2, 3, 4])  
>>> a.dtype  
    dtype('int32')  
>>> b = array([1.2, 3.5, 5.1])　　　  
>>> b.dtype  
    dtype('float64')  
```
使用array函数创建时，参数必须是由方括号括起来的列表，而不能使用多个数值作为参数调用array。
```
>>> a = array(1,2,3,4)    # 错误  
>>> a = array([1,2,3,4])  # 正确
```
可使用双重序列来表示二维的数组，三重序列表示三维数组，以此类推。
```
>>> b = array( [ (1.5,2,3), (4,5,6) ] )　　  
>>> b  
    array([[ 1.5,  2. ,  3. ],  
　　　     [ 4. ,  5. ,  6. ]])
```
可以在创建时显式指定数组中元素的类型
```
>>> c = array( [ [1,2], [3,4] ], dtype=complex)  
>>> c  
    array([[ 1.+0.j,  2.+0.j],  
　　　    [ 3.+0.j,  4.+0.j]])  
```
通常，刚开始时数组的元素未知，而数组的大小已知。因此，NumPy提供了一些使用占位符创建数组的函数。这些函数有助于满足除了数组扩展的需要，同时降低了高昂的运算开销。


#### 快速生成数组

方法 | 描述
---|---
zeros(x) | 创建一个全是0的数组
ones(x) | 创建一个全为1的数组
empty(x) | 创建一个内容随机并且依赖与内存状态的数组，数字全接近0
> 可以传入两种参数，如果传入x则则生成个数为x的数组，如果传入列表则生成x乘y的矩阵

```
>>> empty((2,3))  
　　　array([[  2.65565858e-316,   0.00000000e+000,   0.00000000e+000],  
　　　       [  0.00000000e+000,   0.00000000e+000,   0.00000000e+000]])
```
> 用这种方法创建的数组默认创建的数组类型(dtype)都是float64。

```
>>> d = zeros((3,4))
>>> d.dtype
dtype('float64')
>>> d 
array([[ 0., 0., 0., 0.],
       [ 0., 0., 0., 0.],
       [ 0., 0., 0., 0.]])
>>> d.dtype.itemsize
8
```
也可以自己指定调用方法时数组中元素的类型
```
>>> ones((2,3,4),dtype=int16)
     array([[[1, 1, 1, 1],  
　　　        [1, 1, 1, 1],  
　　　        [1, 1, 1, 1]],  
　　　  
　　　       [[1, 1, 1, 1],  
　　　        [1, 1, 1, 1],  
　　　        [1, 1, 1, 1]]], dtype=int16)  
```

#### arange函数
NumPy提供一个类似arange的函数返回一个数列形式的数组:
```
>>> arange(10, 30, 5)  
    array([10, 15, 20, 25])  
```
以10开始，差值为5的等差数列。该函数不仅接受整数，还接受浮点参数：
```
>>> arange(0,2,0.5)  
    array([ 0. ,  0.5,  1. ,  1.5])  
```
当arange使用浮点数参数时，由于浮点数精度有限，通常无法预测获得的元素个数。因此，最好使用函数linspace去接收我们想要的元素个数来代替用range来指定步长。linespace用法如下:
```
>>> numpy.linspace(-1, 0, 5)  
 array([-1.  , -0.75, -0.5 , -0.25,  0.  ]) 
```
### 数组选取
数组中的元素是通过下标来访问的，可以通过方括号括起一个下标来访问数组中单一一个元素，也可以以切片的形式访问数组中多个元素。
```
a = np.array([[1,2],[3,4]])
print (a)
[[1 2]
 [3 4]]
 
print (a[0,0])
1
```

### 输出数组
当输出一个数组时，NumPy以特定的布局用类似嵌套列表的形式显示：
- 第一行从左到右输出
- 每行依次自上而下输出
- 每个切片通过一个空行与下一个隔开
- 一维数组被打印成行，二维数组成矩阵，三维数组成矩阵列表。
```
>>> a = arange(6)  # 1d array  
>>> print a  
    [0 1 2 3 4 5]  
　　　  
>>> b = arange(12).reshape(4,3)  # 2d array  
>>> print b  
    [[ 0  1  2]  
     [ 3  4  5]  
     [ 6  7  8]  
     [ 9 10 11]]　
     
>>> c = arange(24).reshape(2,3,4)  # 3d array  
>>> print c  
    [[[ 0  1  2  3]  
      [ 4  5  6  7]  
      [ 8  9 10 11]]  
　　　  
     [[12 13 14 15]  
      [16 17 18 19]  
      [20 21 22 23]]]  
```
如果一个数组太长，则NumPy自动省略中间部分而只打印两端的数据：
```
>>> print arange(10000)  
　　　[   0    1    2 ..., 9997 9998 9999]  
　　　  
>>> print arange(10000).reshape(100,100)  
　　　[[   0    1    2 ...,   97   98   99]  
　　　 [ 100  101  102 ...,  197  198  199]  
　　　 [ 200  201  202 ...,  297  298  299]  
　　　 ...,  
　　　 [9700 9701 9702 ..., 9797 9798 9799]  
　　　 [9800 9801 9802 ..., 9897 9898 9899]  
　　　 [9900 9901 9902 ..., 9997 9998 9999]]  
```
> 可通过设置printoptions参数来禁用NumPy的这种行为并强制打印整个数组。

```
set_printoptions(threshold='nan')  
```
这样，输出时数组的所有元素都会显示出来。

---
## 数据类型
对于科学计算来说，Python中自带的整型、浮点型和复数类型远远不够，因此NumPy中添加了许多数据类型。如下：

### NumPy中的基本数据类型
名称|描述
---|---
bool|用一个字节存储的布尔类型（True或False）
inti|由所在平台决定其大小的整数（一般为int32或int64）
int8|一个字节大小，-128 至 127
int16|整数，-32768 至 32767
int32|整数，-2 ** 31 至 2 ** 32 -1
int64|整数，-2 ** 63 至 2 ** 63 - 1
uint8|无符号整数，0 至 255
uint16|无符号整数，0 至 65535
uint32|无符号整数，0 至 2 ** 32 - 1
uint64|无符号整数，0 至 2 ** 64 - 1
float16|半精度浮点数：16位，正负号1位，指数5位，精度10位
float32|单精度浮点数：32位，正负号1位，指数8位，精度23位
float64或float|	双精度浮点数：64位，正负号1位，指数11位，精度52位
complex64|	复数，分别用两个32位浮点数表示实部和虚部
complex128或complex|	复数，分别用两个64位浮点数表示实部和虚部

> Numpy会逐步取消数据类型类型代码的使用，因此类型代码不推荐使用

NumPy类型转换方式如下：
```
>>> float64(42)  
    42.0  
>>> int8(42.0)  
    42  
>>> bool(42)  
    True  
>>> bool(42.0)  
    True  
>>> float(True)  
    1.0  
```
> 注意复数无法转化为整数或浮点数

许多函数的参数中可以指定参数的类型，当然，这个类型参数是可选的。如下：
```
>>> arange(7, dtype=uint16)  
    array([0, 1, 2, 3, 4, 5, 6], dtype=uint16)  
```

### 数据类型转换
可以通过astype()方法对现有的数组进行类型转换
```
>>> arr = np.array([1, 2, 3, 4, 5])
>>> arr.dtype
dtype('int32')
>>> float_arr = arr.astype(np.float64)
>>> float_arr.dtype
dtype('float64')
```
向下转型会将多余的部分切除
```
>>> arr = np.array([3.7, -1.2, -2.6, 0.5, 12.9, 10.1])
>>> arr
array([  3.7,  -1.2,  -2.6,   0.5,  12.9,  10.1])
>>> arr.astype(np.int32)
array([ 3, -1, -2,  0, 12, 10])
```
如果字符串内全都是数字形式，也可以用astype进行转换
```
>>> numeric_strings = np.array(['1.25', '-9.6', '42'], dtype=np.string_)
>>> numeric_strings.astype(float)
array([  1.25,  -9.6 ,  42.  ])
```

### 数据类型对象
每种数据类型都具有byteorder和itemsize两种属性
- byteorder ：指示该数据类型对象的字节顺序的字符。

符号|含义
---|---
\=  |	常规
\<  |	低字节序
\>  |	高字节序
\|  |	不适合
- itemsize：数组中每个元素的字节大小。例如，一个元素类型为float64的数组itemsize属性值为8(float64占用64个bits，每个字节长度为8，所以64/8，占用8个字节），又如，一个元素类型为complex32的数组itemsize属性为4（32/8）。
```
>>> a = np.array([[1,2],[3,4]])
>>> print a.dtype.byteorder
=
>>> print a.dtype.itemsize
4
```

### 创建自定义数据类型
可以自己定义新的数据类型
```
>>> t = np.dtype([('name', np.str_, 40), ('numitems', np.int32), ('price', np.float32)])
>>> print t

>>> print t['name']

>>> itemz = np.array([('Meaning of life DVD', 42, 3.14), ('Butter', 13, 2.72)], dtype=t)

>>> print itemz[1]
```