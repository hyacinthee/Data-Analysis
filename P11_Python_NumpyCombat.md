# P11_PythonNumpy实战

#### 这里是Python数据分析学习的第十一篇笔记
本文利用Numpy进行历史股价分析，包括csv文件的读写，求平均值、最大最小值，统计分析，收益率，日期分析，汇总数据，真实波动幅度均值(ATR)，简单移动平均线，指数移动平均线，布林带、线性模型和趋势线

---
## CSV文件读写
CSV文件是一种以逗号分隔的十分常见的文本数据

可以使用numpy中的loadtxt()方法读取csv文件，读取后系统会自动对文件进行切分
```
# c 表示收盘价  v 表示成交量
>>> c,v=np.loadtxt('data.csv', delimiter=',', usecols=(6,7), unpack=True)
>>> c
array([ 336.1 ,  339.32,  345.03,  344.32,  343.44,  346.5 ,  351.88,
        355.2 ,  358.16,  354.54,  356.85,  359.18,  359.9 ,  363.13,
        358.3 ,  350.56,  338.61,  342.62,  342.88,  348.16,  353.21,
        349.31,  352.12,  359.56,  360.  ,  355.36,  355.76,  352.47,
        346.67,  351.99])

>>> v 
array([ 21144800.,  13473000.,  15236800.,   9242600.,  14064100.,
        11494200.,  17322100.,  13608500.,  17240800.,  33162400.,
        13127500.,  11086200.,  10149000.,  17184100.,  18949000.,
        29144500.,  31162200.,  23994700.,  17853500.,  13572000.,
        14395400.,  16290300.,  21521000.,  17885200.,  16188000.,
        19504300.,  12718000.,  16192700.,  18138800.,  16824200.])

```
> 以上使用相对路径，指明分隔符为逗号`,`，选取了文件中的7、8行(下标从零开始)，并通过unpack属性指明分别存储两行数据

---
## 成交量平均价格
### 加权平均价格
根据权重计算价格
```
>>> vwap = np.average(c, weights=v)
>>> vwap
350.58954935320088
```

### 算术平均值函数
直接计算平均值
```
>>> np.mean(c)
351.03766666666672
```

### 时间加权平均价格
根据时间进行加权，越临近现在的数据权重越大
```
# 使用arange模拟时间
>>> t = np.arange(len(c))
>>> np.average(c, weights=t)
352.42832183908041
```
说明近期的收盘价较以往更高

---
## 最大最小值

首先读取文件中最高价和最低价两栏数据
```
>>> h,l=np.loadtxt('data.csv', delimiter=',', usecols=(4,5), unpack=True)
```
求最大最小值
```
>>> print(np.max(h))
364.9

>>> print(np.min(l))
333.53
```
利用最大最小值求平均值
```
>>> print((np.max(h) + np.min(l)) /2)
349.215
```
求单个数据的波动范围:
```
>>> print(np.ptp(h))
25

>>> print(np.ptp(l))
27

```

---
## 统计分析
### 中位数
```
>>> c=np.loadtxt('data.csv', delimiter=',', usecols=(6,), unpack=True)
>>> print ("median =", np.median(c))
median = 352.055
```
也可以对数组进行排序来寻找中位数
```
>>> sorted = np.msort(c)
>>> print ("sorted =", sorted)
sorted = [ 336.1   338.61  339.32  342.62  342.88  343.44  344.32  345.03  346.5
           346.67  348.16  349.31  350.56  351.88  351.99  352.12  352.47  353.21
           354.54  355.2   355.36  355.76  356.85  358.16  358.3   359.18  359.56
           359.9   360.    363.13]
```
此时发现并不存在`352.055`，这是因为函数自动对中间的两个数取了平均值

### 方差
使用 `var()` 方法计算数组方差
```
>>> print ("variance =", np.var(c))
>>> print ("variance from definition =", np.mean((c - c.mean())**2))
variance = 50.1265178889
variance from definition = 50.1265178889
```
> var()与直接代入公式的结果一致

